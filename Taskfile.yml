version: '3'

includes:
  build: tasks/build/Taskfile-{{OS}}.yml
  frontend: frontend/Taskfile.yml

tasks:
  default:
    desc: Runs the dev task.
    cmds:
      - task: dev

  dev:
    desc: Runs the application in development mode.
    cmds:
      - wails dev

  build-dev:
    desc: Create a development build of the application.
    cmds:
      - wails build

  test-go:
    desc: Run Go tests.
    cmds:
      - go test -cover -race ./...

  test:
    desc: Run Go tests.
    cmds:
      - task: test-go
      - cmd: echo "Tests passed"
        silent: true

  lint:
    desc: Run frontend and Go linters.
    cmds:
      - task: frontend:lint
      - task: lint-go
      - cmd: echo "Checks passed"
        silent: true

  lint-go:
    desc: Run Go linters.
    cmds:
      - golangci-lint run

  fmt-go:
    desc: Run go fmt on improperly formatted Go files.
    cmds:
      - golangci-lint fmt

  pull-exclusions:
    desc: Pull the updates from the zen-https-exclusions repository.
    cmds:
      - git subtree pull --prefix=internal/sysproxy/exclusions https://github.com/ZenPrivacy/zen-https-exclusions master --squash

